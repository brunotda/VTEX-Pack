/**
* PopUps
* @author Carlos Vinicius
* @version 1.24
* @date 2012-10-08
*/
jQuery.fn.vtexPopUp2=function(l){var j=jQuery(this);if(1>j.length)return j;var i=jQuery("body"),d=i.find(".boxPopUp2"),k="object"==typeof console;1>d.length&&(d=jQuery('<div class="boxPopUp2"><div class="boxPopUp2-wrap"><span class="boxPopUp2-close"></span><div class="boxPopUp2-content"></div></div></div>'),i.prepend(d),d.after('<div class="boxPopUp2-overlay"></div>'));var c=jQuery.extend({popupType:null,closeContent:null,popupClass:"",quickViewClass:".quickViewLink",contentUrl:"",initCallback:function(){},
showCallback:function(){},closeCallback:function(){}},l),l=d.find(".boxPopUp2-close"),e=d.find(".boxPopUp2-content"),m=i.find(".boxPopUp2-close, .boxPopUp2-overlay"),n=i.find(".boxPopUp2-overlay"),h=jQuery(document);null!=c.closeContent&&l.html(c.closeContent);var b={positioning:function(){var a=h.scrollTop(),b=jQuery(window).height(),c=d.outerHeight(!0);d.css("top",a+(c>=b?20:(b-c)/2)+"px")},show:function(a){a=a||{};n.fadeTo("fast",0.5,function(){d.show().addClass("popupOpened");"boolean"===typeof a.loading&&
!0===a.loading?b.showLoading():b.hideLoading();"function"===typeof a.callback&&a.callback();c.showCallback(d)})},hideLoading:function(){e.filter(":visible").css("background-image","none")},showLoading:function(){e.filter(":visible").css("background-image",'url("/arquivos/ajax-loader.gif")')},close:function(a){var a=a||{},b=function(){n.fadeOut("fast");d.fadeOut("fast",function(){e.empty()});e.attr("class","boxPopUp2-content");d.attr("class","boxPopUp2")};"boolean"==typeof a.closeNow&&!0==a.closeNow&&
b();1>m.filter(".boxPopUp2-clickActive").length&&(m.addClass("boxPopUp2-clickActive").bind("click",function(){"function"===typeof a.clickCallback?a.clickCallback():c.closeCallback(d);b()}),h.bind("keyup",function(a){27==(a.keyCode?a.keyCode:a.which)&&b()}));if(j.hasClass("autoClose")){var g=(j.attr("class")||"").split("ac_").pop().split(" ").shift();if(isNaN(parseFloat(g)))return k&&console.log("[Erro] O tempo informado (em segundos) n\u00e3o \u00e9 um valor num\u00e9rico: \u201c"+g+"\u201d"),!1;
setTimeout(function(){b()},1E3*g)}},setType:function(a){if(a.hasClass("quickViewLink"))b.quickView(a);else if(a.hasClass("giftListWrap"))b.giftList(a);else if(a.hasClass("installmentInfoTpl"))b.paymentForms(a);else if(a.hasClass("shipping-value"))b.calculateShipping(a);else if(a.hasClass("freeContent"))b.freeContent(a);else if(a.hasClass("boxPopUp2"))b.closeNow(a);else if(a.hasClass("referAFriendTpl"))b.productReferAFriend(a);else if(0<a.filter("#btnReferAFriend").length)b.giftListReferFriend(a);
else if(0<a.filter("#lnkPubliqueResenha").length)b.postRatingComment(a);else if(0<a.filter("#palerta").length)b.cartCheckoutAlert(a);else if(a.hasClass("lnkAddPhoto"))c.popupType="minhaContaFoto",b.userAccount(a);else return!1},checkType:function(a){if("cadastroCliente"===c.popupType||"minhaContaFoto"===c.popupType)b.userAccount(a);else if("newsletter"===c.popupType)b.newsletter(a);else if("quickview"===c.popupType)b.quickView(a);else if("giftlist"===c.popupType)b.giftList(a);else if("paymentforms"===
c.popupType)b.paymentForms(a);else if("shipping"===c.popupType)b.calculateShipping(a);else if("string"==typeof c.popupType&&"freecontent"===c.popupType.toLowerCase())b.freeContent(a);else if("closenow"===c.popupType)b.closeNow(a);else if("GiftListReferAFriend"===c.popupType)b.giftListReferFriend(a);else if("postRatingComment"===c.popupType)b.postRatingComment(a);else return!1},exec:function(){j.each(function(){var a=$(this),d;null===c.popupType?d=b.setType(a):!1===b.checkType(a)&&(d=b.setType(a));
!1===d&&b.freeContent(a)});c.initCallback()},userAccount:function(a){var f="";"cadastroCliente"===c.popupType?f="signInPopups":"minhaContaFoto"===c.popupType&&(f="profilePhoto");a.unbind().removeAttr("onclick");var g=a.attr("href")||"";a.bind("mouseenter",function(){a.unbind().bind("click",function(){d.addClass(c.popupClass+" "+f+"Main");""===g&&k&&console.log("N\u00e3o existe URL no atributo href");jQuery('<iframe src="'+g+'" frameborder="0" allowtransparency="true"></iframe>').appendTo(e.addClass(c.popupClass+
" "+f));b.show({loading:!0});b.positioning();b.close();return!1})})},newsletter:function(a){a.clone().appendTo(e.addClass(c.popupClass+" newsletterPopup"));d.addClass(c.popupClass+" newsletterMain");b.show();b.positioning();b.close()},quickView:function(a){var a=i.find(c.quickViewClass),f=function(){a.filter(":not(.quickViewLinkActivated)").addClass("quickViewLinkActivated").bind("click",function(){jQuery('<iframe src="'+jQuery(this).attr("href")+'" frameborder="0" allowtransparency="true"></iframe>').appendTo(e.addClass(c.popupClass+
" productQuickView"));d.addClass(c.popupClass+" quickViewMain");b.show({loading:!0});b.positioning();b.close();return!1})};f();h.ajaxStop(f)},paymentForms:function(a){var f="",g=function(){var a=i.find(".see-other-payment-method-link");if(1>a.length)return k&&console.log("Url das formas de pagamento n\u00e3o encontrado. \n Verifique se o controle esta na p\u00e1gina.\n("+a.selector+")"),!1;f=/http:(.*?)(?=\&)/.exec(a[0].getAttribute("onclick").toString())[0]||"#onclickError"};g();a.bind("click",function(){jQuery("<iframe src='"+
f+"' frameborder='0' allowtransparency='true'></iframe>").appendTo(e.addClass(c.popupClass+" paymentFormsPopup"));d.addClass(c.popupClass+" paymentFormsMain");b.show({loading:!0});b.positioning();b.close();return!1});h.ajaxStop(g)},calculateShipping:function(){h.ajaxStop(function(){var a=i.find("#calculoFrete").children();if(1>a.length)return!1;a.find("span.cep-busca a").attr("target","_blank");a.appendTo(e.addClass(c.popupClass+" shippingCalculationPopup"));d.addClass(c.popupClass+" shippingCalculationMain");
b.show();b.positioning();b.close()})},giftList:function(a){a.appendTo(e.addClass(c.popupClass+" giftListPopup"));d.addClass(c.popupClass+" giftListMain");b.show();b.positioning();b.close({clickCallback:c.closeCallback})},cartCheckoutAlert:function(a){a.appendTo(e.addClass(c.popupClass+" cartCheckoutAlertPopup"));d.addClass(c.popupClass+" cartCheckoutAlertMain");b.show();b.positioning();b.close()},freeContent:function(a){""==c.contentUrl?a.appendTo(e.addClass(c.popupClass+" freeContentPopup")):a.bind("click",
function(){jQuery('<iframe src="'+c.contentUrl+'" frameborder="0" allowtransparency="true"></iframe>').appendTo(e.addClass(c.popupClass+" freeContentPopup"))});d.addClass(c.popupClass+" freeContentMain");b.show();b.positioning();b.close()},closeNow:function(){b.close({closeNow:!0})},giftListReferFriend:function(a){var f=function(){var a=$(this).attr("href");if("undefined"===typeof a||""===a)return k&&console.log("[Erro] Url do popup n\u00e3o encontrada."),!1;e.addClass(c.popupClass+" freeContentPopup").load(a);
d.addClass(c.popupClass+" giftListReferFriendMain");b.show({loading:!0});b.positioning();b.close();return!1},g=function(){a.unbind().bind("mouseenter",function(){a.unbind().bind("click",f)})};g();h.ajaxStop(g)},productReferAFriend:function(a){var f=jQuery('<div class="referAFriendPopUpWrap"></div>');a.bind("click",function(){var a=(jQuery(this).parent().find("#div-referAFriend input").attr("onclick")||"").toString(),a=/\/referAFriend\/Form\/[0-9]+\?/i.exec(a);if(null===a)return alert("Desculpe, n\u00e3o foi poss\u00edvel abrir o formul\u00e1rio."),
!1;f.empty().load(a[0],function(){b.positioning()});f.appendTo(e.addClass(c.popupClass+" freeContentPopup"));d.addClass(c.popupClass+" freeContentMain");b.show();b.positioning();b.close();return!1});h.ajaxStop(function(){0<e.find(".referAFriendPopUpWrap #btnFechar").length&&setTimeout(b.closeNow,1500)})},postRatingComment:function(a){var a=a.filter(":not(.popUpPublishReviewActivated)"),f=!1;if(1>a.length)return!1;a.bind("click",function(){var a=jQuery(this).attr("href")||"";if(""===a)return k&&console.log("[Erro] N\u00e3o foi poss\u00edvel obter os dados para abrir o popup de resenha."),
!1;a=a.split(")").shift().split("(").pop().split(",");if(3!=a.length)return k&&console.log("[Erro] O array com os dados do cliente retornou um valor inesperado."),!1;if(f)return!1;f=!0;jQuery.ajax({url:"/publishuserreviewcomment",type:"POST",data:{productId:a[1],clientId:a[0],categoryId:a[2]},success:function(a){var g=jQuery(a);e.addClass(c.popupClass+" userReviewPopup").html(g);d.addClass(c.popupClass+" userReviewPopupMain");b.show({callback:function(){g.find("#txtTituloResenha:hidden").val("titulo_auto");
var a=e.find("a#rtAvaliacao_A0"),b=function(){a.attr("title",a.find(".filledRatingStar:last").index()+1||0)};a.find("span").bind("mouseenter",b);a.bind("mouseleave",b)}});b.positioning();b.close();f=!1},error:function(){f=!1}});return!1}).addClass("popUpPublishReviewActivated");0==jQuery.fn.vtexPopUp2.data.userReviewCount&&h.ajaxStop(function(){e.hasClass("userReviewPopup")&&0==e.find(".formUserComment").children().length&&b.closeNow()});jQuery.fn.vtexPopUp2.data.userReviewCount++}};b.exec();return j};
jQuery.fn.vtexPopUp2.data={userReviewCount:0};